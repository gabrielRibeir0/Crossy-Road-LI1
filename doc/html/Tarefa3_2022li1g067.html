<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Tarefa3_2022li1g067</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption empty">&nbsp;</span><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Jos&#233; Lu&#237;s Matos Ribeiro  &lt;a105108@alunos.uminho.pt&gt;<br />Gabriel Pereira Ribeiro  &lt;a104171@alunos.uminho.pt&gt;</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr></table><p class="caption">Tarefa3_2022li1g067</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Fun&#231;&#227;o principal</a></li><li><a href="#g:2">Fun&#231;&#245;es auxiliares</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>M&#243;dulo para a realiza&#231;&#227;o da Tarefa 3 do projeto de LI1 em 2022/23.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:animaJogo">animaJogo</a> :: <a href="LI12223.html#t:Jogo" title="LI12223">Jogo</a> -&gt; <a href="LI12223.html#t:Jogada" title="LI12223">Jogada</a> -&gt; <a href="LI12223.html#t:Jogo" title="LI12223">Jogo</a></li><li class="src short"><a href="#v:moveJogador">moveJogador</a> :: <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; <a href="LI12223.html#t:Largura" title="LI12223">Largura</a> -&gt; [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; <a href="LI12223.html#t:Jogada" title="LI12223">Jogada</a> -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a></li><li class="src short"><a href="#v:posJogador">posJogador</a> :: Int -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a></li><li class="src short"><a href="#v:maxCasas">maxCasas</a> :: (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; Int</li><li class="src short"><a href="#v:moveObstaculos">moveObstaculos</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; Int -&gt; [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])]</li><li class="src short"><a href="#v:moveDireita">moveDireita</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; Int -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]</li><li class="src short"><a href="#v:moveEsquerda">moveEsquerda</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; Int -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Fun&#231;&#227;o principal</h1></a><div class="top"><p class="src"><a id="v:animaJogo" class="def">animaJogo</a> :: <a href="LI12223.html#t:Jogo" title="LI12223">Jogo</a> -&gt; <a href="LI12223.html#t:Jogada" title="LI12223">Jogada</a> -&gt; <a href="LI12223.html#t:Jogo" title="LI12223">Jogo</a> <a href="#v:animaJogo" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:animaJogo" title="Tarefa3_2022li1g067">animaJogo</a></code> &#233; a principal deste m&#243;dulo e respons&#225;vel por devolver o mapa depois de aplicada a movimenta&#231;&#227;o do jogador e dos obst&#225;culos.</p><p>A fun&#231;&#227;o &#233; definida da seguinte forma:</p><pre>animaJogo (Jogo (Jogador (x,y)) (Mapa l ll)) j = Jogo (Jogador (newPos)) (Mapa l (moveObstaculos ll (maxCasas (ll !! snd(newPos)) newPos) ))
    where newPos = moveJogador (x,y) l ll j
</pre><p>A fun&#231;&#227;o principal recorre a outras tr&#234;s fun&#231;&#245;es para processar a movimenta&#231;&#227;o do jogador e dos obst&#225;culos, <code><a href="Tarefa3_2022li1g067.html#v:moveJogador" title="Tarefa3_2022li1g067">moveJogador</a></code> e <code><a href="Tarefa3_2022li1g067.html#v:moveObstaculos" title="Tarefa3_2022li1g067">moveObstaculos</a></code> e <code><a href="Tarefa3_2022li1g067.html#v:maxCasas" title="Tarefa3_2022li1g067">maxCasas</a></code>, respetivamente.</p></div></div><a href="#g:2" id="g:2"><h1>Fun&#231;&#245;es auxiliares</h1></a><div class="top"><p class="src"><a id="v:moveJogador" class="def">moveJogador</a> :: <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; <a href="LI12223.html#t:Largura" title="LI12223">Largura</a> -&gt; [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; <a href="LI12223.html#t:Jogada" title="LI12223">Jogada</a> -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> <a href="#v:moveJogador" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:moveJogador" title="Tarefa3_2022li1g067">moveJogador</a></code> altera a posi&#231;&#227;o do jogador tendo em conta a jogada realizada.</p><pre>moveJogador (x,y) l ll (Move Cima) | snd(ll !! y) !! x == Tronco = if y &lt; 1 || snd(ll !! (y-1)) !! x == Arvore then posJogador 0 (x,y) (ll !! y) else (x,y-1)
                                   | otherwise = if y &lt; 1 || snd(ll !! (y-1)) !! x == Arvore then (x,y) else (x, y-1)
moveJogador (x,y) l ll (Move Baixo) | snd(ll !! y) !! x == Tronco = if y+1 &gt;= length ll || snd(ll !! (y+1)) !! x == Arvore then posJogador 0 (x,y) (ll !! y) else (x,y+1)
                                    | otherwise = if y+1 &gt;= length ll || snd(ll !! (y+1)) !! x == Arvore then (x,y) else (x, y+1)
moveJogador (x,y) l ll (Move Esquerda) | not (x &lt; 1) &amp;&amp; snd(ll !! y) !! (x-1) == Tronco = posJogador (-1) (x,y) (ll !! y)
                                       | otherwise = if x &lt; 1 || snd(ll !! y) !! (x-1) == Arvore then (x, y) else (x-1, y)
moveJogador (x,y) l ll (Move Direita) | not (x+1 &gt;= l) &amp;&amp; snd(ll !! y) !! (x+1) == Tronco = posJogador 1 (x,y) (ll !! y)
                                      | otherwise = if x+1 &gt;= l || snd(ll !! y) !! (x+1) == Arvore then (x, y) else (x+1, y)
moveJogador (x,y) _ ll Parado | snd(ll !! y) !! x == Tronco = posJogador 0 (x,y) (ll !! y)
                              | otherwise = (x,y)
</pre><p>Tem em aten&#231;&#227;o ainda o facto de o jogador n&#227;o poder sair do mapa com a sua jogada, n&#227;o poder estar no mesmo s&#237;tio que uma &#225;rvore e que, caso fique parado em cima de um tronco, se movimente com ele.</p></div></div><div class="top"><p class="src"><a id="v:posJogador" class="def">posJogador</a> :: Int -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> <a href="#v:posJogador" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:posJogador" title="Tarefa3_2022li1g067">posJogador</a></code> auxilia no c&#225;lculo da posi&#231;&#227;o do jogador quando esta &#233; influenciada pela velocidade do tronco onde est&#225;.</p><pre>posJogador 0 (x,y) (Rio v,_) = (x+v,y)
posJogador m (x,y) (Rio v,_) = (x+v+m,y)
</pre><p>Como produz resultados diferentes em 2 situa&#231;&#245;es distintas, recebe um <em><strong>Int</strong></em> para identificar de que caso se trata e qual valor retornar.</p></div></div><div class="top"><p class="src"><a id="v:maxCasas" class="def">maxCasas</a> :: (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; <a href="LI12223.html#t:Coordenadas" title="LI12223">Coordenadas</a> -&gt; Int <a href="#v:maxCasas" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:maxCasas" title="Tarefa3_2022li1g067">maxCasas</a></code> calcula o n&#250;mero m&#225;ximo de casas que os obst&#225;culos se movimentam at&#233; ser, se for o caso, detetado um atropelamento.</p><pre>maxCasas (Estrada 0, _) _ = 0
maxCasas (Estrada v, os) (x,y) | os !! x == Carro = 0
                               | otherwise = if v &gt; 0 then 1 + maxCasas (Estrada (v-1), last os : init os) (x,y) 
                                             else 1 + maxCasas (Estrada (v+1), tail os ++ [head os]) (x,y)
maxCasas _ _ = 100
</pre><p>Caso haja um atropelamento na Estrada onde o jogador est&#225; a fun&#231;&#227;o retorna o valor m&#225;ximo de casas para os obst&#225;culos se moverem, caso contr&#225;rio, retorna um n&#250;mero suficientemente grande para que os osbst&#225;culos de desloquem o n&#250;mero de casas normal.</p></div></div><div class="top"><p class="src"><a id="v:moveObstaculos" class="def">moveObstaculos</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; Int -&gt; [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] <a href="#v:moveObstaculos" class="selflink">#</a></p><div class="doc"><p>Esta fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:moveObstaculos" title="Tarefa3_2022li1g067">moveObstaculos</a></code> &#233; respons&#225;vel por alterar a posi&#231;&#227;o dos obst&#225;culos que se mexem no mapa.</p><pre>moveObstaculos [] _ = [] 
moveObstaculos ((Relva, os):ts) max = (Relva,os) : moveObstaculos ts max
moveObstaculos ((Rio v, os):ts) max | v &gt; max &amp;&amp; v &gt; 0 = (Rio v, moveDireita os max) : moveObstaculos ts max 
                                    | v <a href="=">max &amp;&amp; v</a>= 0 = (Rio v, moveDireita os v) : moveObstaculos ts max 
                                    | abs v &gt; max &amp;&amp; v &lt; 0 = (Rio v, moveEsquerda os max) : moveObstaculos ts max 
                                    | abs v &lt;= max &amp;&amp; v &lt;= 0 = (Rio v, moveEsquerda os (abs v)) : moveObstaculos ts max
moveObstaculos ((Estrada v, os):ts) max | v &gt; max &amp;&amp; v &gt; 0 = (Estrada v, moveDireita os max) : moveObstaculos ts max 
                                        | v <a href="=">max &amp;&amp; v</a>= 0 = (Estrada v, moveDireita os v) : moveObstaculos ts max 
                                        | abs v &gt; max &amp;&amp; v &lt; 0 = (Estrada v, moveEsquerda os max) : moveObstaculos ts max 
                                        | abs v &lt;= max &amp;&amp; v &lt;= 0 = (Estrada v, moveEsquerda os (abs v)) : moveObstaculos ts max
</pre><p>Tem em conta o sentido da movimenta&#231;&#227;o recorrendo para isso a duas fun&#231;&#245;es auxiliares: </p></div></div><div class="top"><p class="src"><a id="v:moveDireita" class="def">moveDireita</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; Int -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] <a href="#v:moveDireita" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:moveDireita" title="Tarefa3_2022li1g067">moveDireita</a></code> que &#233; chamada caso a velocidade naquele terreno seja positiva e que movimenta os obst&#225;culos <em><strong>v</strong></em> posi&#231;&#245;es para a direita, criando um t&#250;nel nas bordas laterais do mapa.</p><pre>moveDireita :: [Obstaculo] -&gt; Int -&gt; [Obstaculo]
moveDireita l 0 = l
moveDireita l n = moveDireita (last l : init l) (n -1)
</pre></div></div><div class="top"><p class="src"><a id="v:moveEsquerda" class="def">moveEsquerda</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; Int -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] <a href="#v:moveEsquerda" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa3_2022li1g067.html#v:moveEsquerda" title="Tarefa3_2022li1g067">moveEsquerda</a></code> que funciona de maneira semelhante &#224; <code><a href="Tarefa3_2022li1g067.html#v:moveDireita" title="Tarefa3_2022li1g067">moveDireita</a></code>, mas para os casos em que a velocidade &#233; negativa, movendo os obst&#225;culos <em><strong>|v|</strong></em> posi&#231;&#245;es para a esquerda.</p><pre>moveEsquerda :: [Obstaculo] -&gt; Int -&gt; [Obstaculo]
moveEsquerda l 0 = l
moveEsquerda l n = moveEsquerda (tail l ++ [head l] ) (n - 1)
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>